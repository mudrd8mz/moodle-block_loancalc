define(["jquery","core/str"],function(a,b){"use strict";function c(b){var c=a("form#"+b);if(console.debug("Initialising the UI for the loan calculator "+b),!c.length)throw new Error("Unable to find loan calculator wrapper ID "+b);c.find("[data-calculate]").click(function(b){d(c,a(this).data("calculate")),b.stopPropagation()})}function d(c,d){var g=e(c);["amountofloan","repaymentamount","loanterm"].forEach(function(a){var e=c.find("input[name="+a+"]");e.removeAttr("placeholder"),isNaN(g[a])&&d!==a&&b.get_string("insertvalue","block_loancalc").done(function(a){e.attr("placeholder",a)})}),a.each(g,function(a,b){if(isNaN(b)&&a!==d)throw new Error("Missing value for field "+a)});var h,i,j,k=parseFloat("0"),l=g.repaymentfreq*g.loanterm,m=-parseFloat(g.repaymentamount),n=g.interestrate/g.repaymentfreq/100,o=parseFloat(g.amountofloan);if(console.debug("Calculating value of the field "+d),console.debug(g),"amountofloan"===d)0===n?o=-(k+m*l):(i=Math.pow(1+n,-l),j=Math.pow(1+n,l),o=-(i*(k*n-m+j*m))/n),g.amountofloan=o;else if("loanterm"===d){if(0===n){if(0===m)throw new Error("Division by zero");l=-(k+o)/m}else l=Math.log((-k*n+m)/(m+n*o))/Math.log(1+n);if(0===l)throw new Error("Can't compute the Loan term for the present values.");if(l/=g.repaymentfreq,isNaN(l))throw new Error("The repayment amount is less than the interest.");g.loanterm=l}else if("repaymentamount"===d){if(0===n){if(0===l)throw new Error("Division by zero");m=(k+o)/l}else h=Math.pow(1+n,l),m=n*(k+h*o)/(-1+h);g.repaymentamount=m}f(c,g)}function e(b){var c={};return a.each(b.serializeArray(),function(a,b){c[b.name]=parseFloat(b.value)}),c}function f(b,c){a.each(c,function(a,c){"repaymentfreq"===a||isNaN(c)||b.find("[name="+a+"]").val(g(c))})}function g(a){if(isNaN(a))return"";var b=0>a;a=Math.abs(a),a=Math.floor(100*a+.5);for(var c=3,d="";c-- >0||a>0;)d=a%10+d,a=Math.floor(a/10),1==c&&(d="."+d);return b&&(d="-"+d),d}return{init:c}});